{
  "$schema": "../src/sink.schema.json",
  "description": "Install Colima (container runtimes on macOS and Linux)",
  "version": "1.0.0",
  "platforms": [
    {
      "os": "darwin",
      "match": "darwin*",
      "name": "macOS",
      "install_steps": [
        {
          "name": "Ensure Homebrew is installed",
          "check": "command -v brew",
          "error": "Error: Homebrew is required but not installed. Please run platform-dependencies.json first or install manually from https://brew.sh"
        },
        {
          "name": "Install Colima",
          "check": "command -v colima",
          "on_missing": [
            {
              "name": "Install Colima via Homebrew",
              "command": "brew install colima",
              "error": "Failed to install Colima. Check Homebrew and network connection."
            }
          ]
        },
        {
          "name": "Install Docker CLI",
          "check": "command -v docker",
          "on_missing": [
            {
              "name": "Install Docker CLI via Homebrew",
              "command": "brew install docker",
              "error": "Failed to install Docker CLI. Check Homebrew and network connection."
            }
          ]
        },
        {
          "name": "Verify Colima installation",
          "command": "colima version"
        }
      ]
    },
    {
      "os": "linux",
      "match": "linux*",
      "name": "Linux",
      "distributions": [
        {
          "ids": ["ubuntu", "debian"],
          "name": "Ubuntu/Debian",
          "install_steps": [
            {
              "name": "Install Colima",
              "check": "command -v colima",
              "on_missing": [
                {
                  "name": "Download and install Colima",
                  "command": "curl -fsSL https://github.com/abiosoft/colima/releases/latest/download/colima-$(uname)-$(uname -m) -o /tmp/colima && sudo install /tmp/colima /usr/local/bin/colima && rm /tmp/colima",
                  "error": "Failed to install Colima. Check network connection and GitHub availability."
                }
              ]
            },
            {
              "name": "Install Docker CLI",
              "check": "command -v docker",
              "on_missing": [
                {
                  "name": "Install Docker via apt",
                  "command": "sudo apt-get update -qq && sudo apt-get install -y docker.io",
                  "error": "Failed to install Docker CLI. Check repository configuration."
                }
              ]
            },
            {
              "name": "Verify Colima installation",
              "command": "colima version"
            }
          ]
        },
        {
          "ids": ["fedora", "rhel", "centos", "rocky", "almalinux"],
          "name": "Red Hat Family",
          "install_steps": [
            {
              "name": "Install Colima",
              "check": "command -v colima",
              "on_missing": [
                {
                  "name": "Download and install Colima",
                  "command": "curl -fsSL https://github.com/abiosoft/colima/releases/latest/download/colima-$(uname)-$(uname -m) -o /tmp/colima && sudo install /tmp/colima /usr/local/bin/colima && rm /tmp/colima",
                  "error": "Failed to install Colima. Check network connection and GitHub availability."
                }
              ]
            },
            {
              "name": "Install Docker CLI",
              "check": "command -v docker",
              "on_missing": [
                {
                  "name": "Install Docker via dnf",
                  "command": "sudo dnf install -y docker",
                  "error": "Failed to install Docker CLI. Check repository configuration."
                }
              ]
            },
            {
              "name": "Verify Colima installation",
              "command": "colima version"
            }
          ]
        }
      ],
      "fallback": {
        "error": "Unsupported Linux distribution. Please install Colima manually from https://github.com/abiosoft/colima"
      }
    }
  ],
  "fallback": {
    "error": "Unsupported operating system. Colima requires macOS or Linux."
  }
}
